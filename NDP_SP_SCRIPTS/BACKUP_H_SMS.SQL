create or replace PROCEDURE "BACKUP_H_SMS"(
    NUMBER_OF_DAYS IN NUMBER := 7
  ) AS
CURSOR CAMPAIGNS IS
        SELECT CAMPAIGN_ID from ADM_CAMPAIGNS;
newTableName varchar2(30);
RUN_ID NUMBER;
BEGIN
SELECT H_SP_EXEC_TIME_RUN_SEQ.nextval INTO RUN_ID FROM dual;
newTableName := 'H_SMS_ARCHIVE';
 LOG_H_SP_EXEC_TIME(RUN_ID, 'BACKUP_H_SMS', systimestamp, null);
FOR CAMP IN CAMPAIGNS LOOP
    BEGIN
    FOR i IN 0..9 LOOP
        LOG_H_SP_EXEC_TIME(RUN_ID, 'BACKUP_H_SMS_'|| CAMP.CAMPAIGN_ID || '_' || i, systimestamp, null);
        EXECUTE IMMEDIATE 'INSERT /*+APPEND*/ INTO '||newTableName||' SELECT * FROM H_SMS WHERE CAMPAIGN_ID = '||CAMP.CAMPAIGN_ID||' AND MSISD_PART_DIGIT = '||i||' AND TRUNC(HISTORY_DATE) < TRUNC( sysdate - '||NUMBER_OF_DAYS||')';
        DELETE FROM H_SMS WHERE CAMPAIGN_ID = CAMP.CAMPAIGN_ID AND MSISD_PART_DIGIT = TO_CHAR(i) AND TRUNC(HISTORY_DATE) < TRUNC( sysdate - NUMBER_OF_DAYS);
        COMMIT;
        LOG_H_SP_EXEC_TIME(RUN_ID, 'BACKUP_H_SMS_'|| CAMP.CAMPAIGN_ID || '_' || i, systimestamp, null);
	END LOOP;
    END;
END LOOP;
 LOG_H_SP_EXEC_TIME(RUN_ID, 'BACKUP_H_SMS', systimestamp, null);
END;